# การอัปเดตการแสดงคะแนนรวมในแต่ละบทเรียน

## สรุปการเปลี่ยนแปลง

ได้ทำการอัปเดตระบบการแสดงคะแนนรวมในแต่ละบทเรียนให้ตรงกับ Firebase และแสดงผลในรูปแบบที่ชัดเจน พร้อมแก้ไขระบบการปลดล็อคบทเรียน

## การเปลี่ยนแปลงที่ทำ

### 1. สร้าง LessonScoreService ใหม่
- ไฟล์: `lib/services/lesson_score_service.dart`
- หน้าที่: ดึงคะแนนรวมของแต่ละบทเรียนจาก Firebase
- รองรับการคำนวณคะแนนตามจำนวนข้อสอบที่กำหนด
- เพิ่มการตรวจสอบการเสร็จสมบูรณ์ของบทเรียน

### 2. อัปเดตจำนวนข้อสอบในแต่ละบท
- **วิชาคอมพิวเตอร์:**
  - บทที่ 1: 35 ข้อ (ต้องผ่าน 4 ด่าน)
  - บทที่ 2: 45 ข้อ (ต้องผ่าน 5 ด่าน)
  - บทที่ 3: 35 ข้อ (ต้องผ่าน 4 ด่าน)
- **วิชาอิเล็กทรอนิกส์:**
  - บทที่ 1: 40 ข้อ (ต้องผ่าน 5 ด่าน)
  - บทที่ 2: 40 ข้อ (ต้องผ่าน 5 ด่าน)
  - บทที่ 3: 40 ข้อ (ต้องผ่าน 5 ด่าน)

### 3. อัปเดตการแสดงผลในแต่ละวิชา

#### วิชาคอมพิวเตอร์ (`computertech_page.dart`)
- เพิ่มการแสดงคะแนนรวมในรูปแบบ "ได้คะแนน X/35" (หรือ 45 สำหรับบทที่ 2)
- แสดงคะแนนตรงด้านซ้ายล่างของไอคอนบทเรียน
- ใช้สีที่มองเห็นชัดเจนบนพื้นหลังขาว-ดำ

#### วิชาอิเล็กทรอนิกส์ (`electronics_page.dart`)
- เพิ่มการแสดงคะแนนรวมในรูปแบบ "ได้คะแนน X/40"
- แสดงคะแนนตรงด้านซ้ายล่างของไอคอนบทเรียน
- ใช้สีที่มองเห็นชัดเจนบนพื้นหลังขาว-ดำ

### 4. ระบบการแสดงคะแนนใหม่
- **เมื่อยังไม่เสร็จ:** แสดง "??/Y" (Y คือคะแนนเต็มในบทนั้น)
- **เมื่อเสร็จแล้ว:** แสดง "ได้คะแนน X/Y" (X คือคะแนนที่ได้)
- **เงื่อนไข:** แสดงคะแนนจริงเมื่อผ่านทุกด่านในบทนั้นแล้วเท่านั้น

### 5. ระบบการปลดล็อคบทเรียน
- **บทที่ 1:** ปลดล็อคตั้งแต่เริ่มต้น
- **บทที่ 2:** ปลดล็อคเมื่อผ่านบทที่ 1 ครบทุกด่าน
- **บทที่ 3:** ปลดล็อคเมื่อผ่านบทที่ 2 ครบทุกด่าน

### 6. ปุ่มรีเซ็ท
- **แสดงเมื่อ:** ทำทุกบทในวิชาครบแล้วเท่านั้น
- **ตำแหน่ง:** หน้าบทเรียนหลัก (ไม่ใช่หน้าเลือกด่าน)
- **ฟังก์ชัน:** รีเซ็ทความคืบหน้าทั้งหมดของวิชานั้น

### 7. การออกแบบ UI
- **สีข้อความ:** สีขาวบนพื้นหลังดำโปร่งใส
- **ขอบ:** เส้นขอบสีขาวโปร่งใสเพื่อความชัดเจน
- **เงา:** เพิ่มเงาสีดำเพื่อให้อ่านง่ายบนพื้นหลังหลากหลาย
- **ตำแหน่ง:** ด้านซ้ายล่างของไอคอนบทเรียน

## ไฟล์ที่เปลี่ยนแปลง

1. `lib/services/lesson_score_service.dart` - ใหม่ + อัปเดต
2. `lib/services/subject_progress_service.dart` - อัปเดตจำนวนข้อสอบ
3. `lib/subject/computertech_page.dart` - เพิ่มการแสดงคะแนน + แก้ไขระบบปลดล็อค
4. `lib/subject/electronics_page.dart` - เพิ่มการแสดงคะแนน + แก้ไขระบบปลดล็อค

## การทำงานของระบบ

1. **การปลดล็อคบทเรียน:**
   - ตรวจสอบจาก `completedStages` ใน Firebase
   - บทเรียนจะปลดล็อคเมื่อผ่านด่านที่กำหนดครบแล้ว

2. **การแสดงคะแนน:**
   - แสดง "??/Y" เมื่อยังไม่เสร็จ
   - แสดง "ได้คะแนน X/Y" เมื่อเสร็จแล้ว
   - คะแนนจะอัปเดตแบบ real-time

3. **ปุ่มรีเซ็ท:**
   - ตรวจสอบจาก `isSubjectCompleted` ใน LessonScoreService
   - แสดงเมื่อทุกบทในวิชาเสร็จสมบูรณ์แล้ว

## ข้อดีของการเปลี่ยนแปลง

- **ความชัดเจน:** ผู้ใช้เห็นสถานะของแต่ละบทได้ทันที
- **ความถูกต้อง:** ระบบปลดล็อคทำงานตามเงื่อนไขที่กำหนด
- **การใช้งานง่าย:** ไม่ต้องเข้าไปดูในรายละเอียดเพื่อดูคะแนน
- **ความสวยงาม:** UI ที่ออกแบบมาอย่างดี ใช้สีที่เหมาะสม
- **ประสิทธิภาพ:** ดึงข้อมูลครั้งเดียวและแสดงผลทันที
- **ความปลอดภัย:** ปุ่มรีเซ็ทแสดงเฉพาะเมื่อเหมาะสม

## การทดสอบ

ระบบพร้อมใช้งานและสามารถทดสอบได้ทันที โดย:
1. เข้าหน้าบทเรียนของแต่ละวิชา
2. ตรวจสอบการแสดงคะแนนในแต่ละบท (??/Y หรือ ได้คะแนน X/Y)
3. ทดสอบการปลดล็อคบทเรียนตามลำดับ
4. ทดสอบการแสดงปุ่มรีเซ็ทเมื่อเสร็จทุกบท
5. ตรวจสอบความถูกต้องของข้อมูลกับ Firebase
